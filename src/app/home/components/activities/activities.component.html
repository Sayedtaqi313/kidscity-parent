<app-loader *ngIf="isLoading"></app-loader>

<div *ngIf="!isLoading">
  <ng-container
    *ngIf="
      activities.length + alternativeActivities.length > 0;
      else noActivities
    "
  >
    <div
      *ngIf="activities.length > 0"
      class="max-w-7xl mx-auto px-4 py-16 mt-6 mb-6"
    >
      <h3
        *ngIf="type == 'Indoor' || type == 'Outdoor'"
        class="text-2xl font-winky font-semibold text-gray-800 mb-6 flex items-center gap-2"
      >
        <lucide-icon
          name="activity"
          class="w-6 h-6 text-kid-pink"
        ></lucide-icon>
        Explore {{ type == "Indoor" ? "Indoor" : "Outdoor" }} Activities
      </h3>
      <h3
        *ngIf="type == 'In' || type == 'Out'"
        class="text-2xl font-winky font-semibold text-gray-800 mb-6 flex items-center gap-2"
      >
        <lucide-icon
          name="activity"
          class="w-6 h-6 text-kid-pink"
        ></lucide-icon>
        {{
          type == "In"
            ? "Explore fun and exciting activities near you!"
            : "Discover amazing activities beyond your city!"
        }}
      </h3>
      <h3
        *ngIf="!type"
        class="text-2xl font-winky font-semibold text-gray-800 mb-6 flex items-center gap-2"
      >
        <lucide-icon
          name="activity"
          class="w-6 h-6 text-kid-pink"
        ></lucide-icon>
        Discover activities available for the next 5 days!
      </h3>

      <div class="relative">
        <button
          (click)="scrollLeft()"
          class="absolute left-0 top-1/2 transform -translate-y-1/2 z-10 bg-gray-200 hover:bg-gray-300 rounded-full p-2 shadow-md"
        >
          <lucide-icon
            name="chevron-left"
            class="w-6 h-6 text-gray-700"
          ></lucide-icon>
        </button>
        <div
          #slider
          class="flex space-x-4 overflow-x-auto scroll-smooth no-scrollbar p-4"
          (scroll)="updateActiveIndex()"
        >
          <div
            *ngFor="let activity of activities; let i = index"
            class="bg-white rounded-xl overflow-hidden shadow-lg hover:shadow-xl transition-all duration-300 border border-gray-100 min-w-[300px]"
          >
            <div class="relative">
              <img
                [src]="activity.imageUrl"
                alt="Activity"
                class="w-full h-48 object-cover"
              />
              <div class="absolute top-4 right-4">
                <span
                  class="bg-green-500 text-white px-4 py-1.5 rounded-full text-sm font-medium shadow-lg"
                >
                  {{ activity.type }} Activity
                </span>
              </div>
            </div>
            <div class="p-6">
              <h3 class="text-xl font-winky font-bold text-gray-900 mb-3">
                {{ activity.title }}
              </h3>
              <div class="flex items-center text-gray-600 mb-4">
                <lucide-icon name="MapPin" class="w-4 h-4 mr-2"></lucide-icon>
                <span class="text-sm">{{ activity.location }}</span>
              </div>
              <div class="flex items-center space-x-3 mb-4">
                <div
                  class="flex items-center bg-blue-50 rounded-full px-3 py-1.5"
                >
                  <lucide-icon
                    name="Baby"
                    class="w-4 h-4 text-green-500 mr-1.5"
                  ></lucide-icon>
                  <span class="text-sm text-green-700"
                    >Min {{ activity.minAge }}yrs</span
                  >
                </div>
                <div
                  class="flex items-center bg-green-50 rounded-full px-3 py-1.5"
                >
                  <lucide-icon
                    name="User"
                    class="w-4 h-4 text-blue-500 mr-1.5"
                  ></lucide-icon>
                  <span class="text-sm text-blue-700"
                    >Max {{ activity.maxAge }}yrs</span
                  >
                </div>
              </div>
              <p class="text-gray-600 text-sm leading-relaxed mb-6">
                {{ activity.shortDescription }}
              </p>
              <div class="flex items-center space-x-3">
                <button
                  (click)="handleActivityAction(activity)"
                  class="flex-1 font-medium py-2 px-4 rounded-lg transition-colors duration-200 text-white"
                  [ngClass]="{
                    'bg-red-500 hover:bg-red-600': activity.isJoined,
                    'bg-green-500 hover:bg-green-600': !activity.isJoined
                  }"
                >
                  {{ activity.isJoined ? "Cancel" : "Join" }}
                </button>
                <button
                  (click)="navigateToDetail(activity.id)"
                  class="flex-1 bg-blue-500 hover:bg-blue-600 font-medium py-2 px-4 rounded-lg transition-colors text-white duration-200"
                >
                  Details
                </button>
              </div>
            </div>
          </div>
        </div>
        <button
          (click)="scrollRight()"
          class="absolute right-0 top-1/2 transform -translate-y-1/2 bg-gray-200 hover:bg-gray-300 rounded-full p-2 shadow-md"
        >
          <lucide-icon
            name="chevron-right"
            class="w-6 h-6 text-gray-700"
          ></lucide-icon>
        </button>
      </div>

      <div class="flex justify-center mt-4 space-x-2 z-50">
        <span
          *ngFor="let dot of dots; let i = index"
          class="w-3 h-3 rounded-full transition-all duration-300 cursor-pointer"
          [ngClass]="{
            'bg-green-500 scale-125': activeIndex === i,
            'bg-blue-500': activeIndex !== i
          }"
          (click)="scrollToIndex(i)"
        ></span>
      </div>
    </div>

    <div
      *ngIf="alternativeActivities.length > 0"
      class="max-w-7xl mx-auto px-4 mb-6"
      [class.mt-24]="activities.length === 0"
    >
      <h3
        *ngIf="type == 'Indoor' || type == 'Outdoor'"
        class="text-2xl font-winky font-semibold text-gray-800 mb-6 flex items-center gap-2"
      >
        <lucide-icon
          name="activity"
          class="w-6 h-6 text-kid-pink"
        ></lucide-icon>
        Explore {{ type == "Indoor" ? "Outdoor" : "Indoor" }} Activities
      </h3>
      <h3
        *ngIf="type == 'In' || type == 'Out'"
        class="text-2xl font-winky font-semibold text-gray-800 mb-6 flex items-center gap-2"
      >
        <lucide-icon
          name="activity"
          class="w-6 h-6 text-kid-pink"
        ></lucide-icon>
        {{
          type == "In"
            ? "Discover amazing activities beyond your city!"
            : "Explore fun and exciting activities near you!"
        }}
      </h3>
      <h3
        *ngIf="!type"
        class="text-2xl font-winky font-semibold text-gray-800 mb-6 flex items-center gap-2"
      >
        <lucide-icon
          name="activity"
          class="w-6 h-6 text-kid-pink"
        ></lucide-icon>
        Explore more available activities!
      </h3>

      <div class="relative">
        <button
          (click)="scrollLeftAlt()"
          class="absolute left-0 top-1/2 transform -translate-y-1/2 z-50 bg-gray-200 hover:bg-gray-300 rounded-full p-2 shadow-md"
        >
          <lucide-icon
            name="chevron-left"
            class="w-6 h-6 text-gray-700"
          ></lucide-icon>
        </button>
        <div
          #sliderAlt
          class="flex space-x-6 overflow-x-auto scroll-smooth no-scrollbar p-4"
          (scroll)="updateAltActiveIndex()"
        >
          <div
            *ngFor="let activity of alternativeActivities; let i = index"
            class="bg-white rounded-xl overflow-hidden shadow-lg hover:shadow-xl transition-all duration-300 border border-gray-100 min-w-[300px]"
          >
            <div class="relative">
              <img
                [src]="activity.imageUrl"
                alt="Activity"
                class="w-full h-48 object-cover"
              />
              <div class="absolute top-4 right-4">
                <span
                  class="bg-green-500 text-white px-4 py-1.5 rounded-full text-sm font-medium shadow-lg"
                >
                  {{ activity.type }} Activity
                </span>
              </div>
            </div>
            <div class="p-6">
              <h3 class="text-xl font-winky font-bold text-gray-900 mb-3">
                {{ activity.title }}
              </h3>
              <div class="flex items-center text-gray-600 mb-4">
                <lucide-icon name="MapPin" class="w-4 h-4 mr-2"></lucide-icon>
                <span class="text-sm">{{ activity.location }}</span>
              </div>
              <div class="flex items-center space-x-3 mb-4">
                <div
                  class="flex items-center bg-blue-50 rounded-full px-3 py-1.5"
                >
                  <lucide-icon
                    name="Baby"
                    class="w-4 h-4 text-green-500 mr-1.5"
                  ></lucide-icon>
                  <span class="text-sm text-green-700"
                    >Min {{ activity.minAge }}yrs</span
                  >
                </div>
                <div
                  class="flex items-center bg-green-50 rounded-full px-3 py-1.5"
                >
                  <lucide-icon
                    name="User"
                    class="w-4 h-4 text-blue-500 mr-1.5"
                  ></lucide-icon>
                  <span class="text-sm text-blue-700"
                    >Max {{ activity.maxAge }}yrs</span
                  >
                </div>
              </div>
              <p class="text-gray-600 text-sm leading-relaxed mb-6">
                {{ activity.shortDescription }}
              </p>
              <div class="flex items-center space-x-3">
                <button
                  (click)="handleActivityAction(activity)"
                  class="flex-1 font-medium py-2 px-4 rounded-lg transition-colors duration-200 text-white"
                  [ngClass]="{
                    'bg-red-500 hover:bg-red-600': activity.isJoined,
                    'bg-green-500 hover:bg-green-600': !activity.isJoined
                  }"
                >
                  {{ activity.isJoined ? "Cancel" : "Join" }}
                </button>
                <button
                  (click)="navigateToDetail(activity.id)"
                  class="flex-1 bg-blue-500 hover:bg-blue-600 active:bg-gray-300 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200"
                >
                  Details
                </button>
              </div>
            </div>
          </div>
        </div>
        <button
          (click)="scrollRightAlt()"
          class="absolute right-0 top-1/2 transform -translate-y-1/2 bg-gray-200 hover:bg-gray-300 rounded-full p-2 shadow-md"
        >
          <lucide-icon
            name="chevron-right"
            class="w-6 h-6 text-gray-700"
          ></lucide-icon>
        </button>
      </div>

      <div class="flex justify-center mt-4 space-x-2 z-50">
        <span
          *ngFor="let dot of altDots; let i = index"
          class="w-3 h-3 rounded-full transition-all duration-300 cursor-pointer"
          [ngClass]="{
            'bg-green-500 scale-125': activeAltIndex === i,
            'bg-blue-500': activeAltIndex !== i
          }"
          (click)="scrollToAltIndex(i)"
        ></span>
      </div>
    </div>
  </ng-container>

  <ng-template #noActivities>
    <div
      class="min-h-screen max-w-lg mx-auto px-4 flex justify-center items-center"
    >
      <app-no-activity></app-no-activity>
    </div>
  </ng-template>
</div>
